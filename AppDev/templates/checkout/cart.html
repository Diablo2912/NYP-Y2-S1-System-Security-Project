{% extends "base.html" %}

{% block content %}

<style>
  :root{
    --cart-green:#198754;
    --cart-wash:#f6fbf8;
    --cart-border: rgba(25,135,84,.18);
  }
  .cart-shell{
    max-width: 1100px;
  }
  .cart-head{
    font-weight: 800;
    letter-spacing:.2px;
  }
  .cart-card{
    background:#fff;
    border:1px solid var(--cart-border);
    border-radius: 16px;
    box-shadow: 0 10px 26px rgba(0,0,0,.06);
  }
  .cart-item + .cart-item{
    border-top: 1px dashed rgba(0,0,0,.08);
  }
  .thumb{
    width:80px;height:80px;object-fit:cover;border-radius:12px;
    background: var(--cart-wash);
    border:1px solid var(--cart-border);
  }
  .qty-pill{
    min-width: 46px; text-align:center;
    border:1px solid var(--cart-border);
    background:#fff; border-radius:999px; padding:.25rem .6rem;
  }
  .btn-qty{
    width:36px;height:36px;border-radius:999px;
    display:inline-flex;align-items:center;justify-content:center;
  }
  .summary{
    position: sticky; top: 88px;
  }
</style>

<div class="container cart-shell my-4">
  <h2 class="text-center cart-head text-success mb-4">Shopping Cart</h2>

  {% if cart %}
  <div class="row g-4">
    <!-- Items -->
    <div class="col-lg-8">
      <div class="cart-card p-3 p-sm-4">
        {% for product in cart.values() %}
        <div class="cart-item py-3">
          <div class="d-flex align-items-center gap-3 gap-sm-4">
            <!-- Image -->
            <img src="{{ product.image }}" alt="{{ product.name }}" class="thumb">

            <!-- Details -->
            <div class="flex-grow-1">
              <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                <div>
                  <h5 class="mb-1 text-success">{{ product.name }}</h5>
                  <div class="text-muted small">
                    Unit: ${{ "%.2f"|format(product.price) }}
                  </div>
                </div>
                <div class="text-end">
                  <span class="badge text-bg-light border">
                    Line total:
                    <span class="fw-semibold text-success">
                      ${{ "%.2f"|format(product.price * product.quantity) }}
                    </span>
                  </span>
                </div>
              </div>

              <!-- Quantity controls -->
              <div class="mt-2 d-flex align-items-center gap-2">
                <form action="{{ url_for('update_cart') }}" method="POST" class="d-inline">
                  <input type="hidden" name="product_id" value="{{ product.id }}">
                  <input type="hidden" name="action" value="decrease">
                  <button type="submit" class="btn btn-outline-danger btn-qty" aria-label="Decrease">âˆ’</button>
                </form>

                <span class="qty-pill">{{ product.quantity }}</span>

                <form action="{{ url_for('update_cart') }}" method="POST" class="d-inline">
                  <input type="hidden" name="product_id" value="{{ product.id }}">
                  <input type="hidden" name="action" value="increase">
                  <button type="submit" class="btn btn-outline-success btn-qty" aria-label="Increase">+</button>
                </form>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      <!-- Actions under list (mobile friendly) -->
      <div class="d-lg-none mt-3">
        <form action="{{ url_for('clear_cart') }}" method="POST" class="mb-2">
          <button type="submit" class="btn btn-outline-danger w-100">Clear Cart</button>
        </form>
        <a href="{{ url_for('checkout') }}" class="btn btn-success w-100">Proceed to Checkout</a>
      </div>
    </div>

    <!-- Summary -->
    <div class="col-lg-4">
      <div class="cart-card p-3 p-sm-4 summary">
        <h5 class="mb-3">Order Summary</h5>
        <div class="d-flex justify-content-between">
          <span class="text-muted">Subtotal</span>
          <span class="fw-semibold">${{ "%.2f"|format(total_price) }}</span>
        </div>
        <div class="d-flex justify-content-between mt-2">
          <span class="text-muted">Shipping</span>
          <span class="fw-semibold">Calculated at checkout</span>
        </div>
        <hr>
        <div class="d-flex justify-content-between align-items-center">
          <span class="fs-5">Total</span>
          <span class="fs-5 fw-bold text-success">${{ "%.2f"|format(total_price) }}</span>
        </div>

        <div class="mt-3 d-grid gap-2">
          <a href="{{ url_for('checkout') }}" class="btn btn-success">Proceed to Checkout</a>
          <form action="{{ url_for('clear_cart') }}" method="POST">
            <button type="submit" class="btn btn-outline-danger w-100">Clear Cart</button>
          </form>
          <a href="{{ url_for('buy_product') }}" class="btn btn-outline-secondary w-100">Continue Shopping</a>
        </div>
      </div>
    </div>
  </div>

  {% else %}
    <div class="text-center py-5 cart-card mx-auto" style="max-width:720px;">
      <p class="fs-5 mb-3 text-muted">Your cart is empty.</p>
      <a href="{{ url_for('buy_product') }}" class="btn btn-success">Browse Products</a>
    </div>
  {% endif %}
</div>

{% endblock %}
